<template>
    <div class="modal" id="AddFunds2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <p class="font-400 mb-0 display-4 pl-3">Add Funds</p>
                    <button type="button btn_close" class="close" data-dismiss="modal" aria-label="Close" @click="closeModal('onetime')">
                    <span aria-hidden="true">
                        <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M0.631055 0H0.864551C0.993164 0.028125 1.12412 0.0667969 1.22988 0.148242C1.32305 0.219727 1.40127 0.308203 1.48477 0.390234C3.36943 2.2752 5.2541 4.15986 7.13906 6.04453C7.26006 6.16377 7.37666 6.28799 7.50234 6.40254C7.95146 5.96865 8.38682 5.52012 8.83066 5.08066C10.4423 3.46934 12.0533 1.85771 13.6649 0.24668C13.783 0.120703 13.9421 0.0462891 14.1059 0H14.3121C14.4832 0.0307617 14.6528 0.0975586 14.7756 0.224414C14.8904 0.332812 14.9525 0.481934 15 0.629297V0.864844C14.9698 1.03564 14.8986 1.20234 14.7712 1.32305C13.0474 3.04688 11.3235 4.7707 9.59971 6.49453C9.26777 6.83086 8.92734 7.15869 8.60039 7.5C9.52793 8.44189 10.4689 9.37061 11.4018 10.3072C12.5247 11.4305 13.6479 12.5537 14.7712 13.6767C14.8986 13.7974 14.9704 13.9641 15 14.1352V14.3704C14.9449 14.5518 14.8535 14.7308 14.6956 14.8433C14.5846 14.9291 14.448 14.973 14.3121 15H14.1064C13.943 14.9531 13.7836 14.8787 13.6655 14.753C12.1225 13.21 10.5794 11.6669 9.03633 10.1238C8.52393 9.61611 8.02061 9.09902 7.50264 8.59688C5.43223 10.6544 3.37471 12.7248 1.30781 14.7853C1.18887 14.9051 1.02715 14.9672 0.864551 15H0.631934C0.445898 14.9373 0.261328 14.8438 0.147949 14.6769C0.055957 14.5559 0.0181641 14.4044 0 14.2562V14.1917C0.0205078 14.0016 0.093457 13.8146 0.232031 13.6796C2.20928 11.7018 4.1874 9.72451 6.16465 7.74668C6.24727 7.6667 6.32783 7.58496 6.40518 7.49971C6.00996 7.08838 5.59922 6.6917 5.19844 6.28594C3.54287 4.63066 1.8876 2.97539 0.232324 1.32012C0.093457 1.18535 0.0205078 0.998438 0 0.808301V0.744141C0.0172852 0.602344 0.0518555 0.45791 0.135937 0.339844C0.248437 0.164063 0.438867 0.0647461 0.631055 0Z" fill="white"></path>
                        </svg>
                    </span>
                    </button>
                </div>
                <div class="modal-body pt-0">
                    <div class="title_div">
                        <p class="display-2 font-400 border-bottom text-center py-3 mb-0">Choose amount to add by clicking on a box below</p>
                    </div>
                    <div class="price_btn">
                        <div class="row">
                            <div class="col-md-3 px-2" v-for="(plan, pindex) in oneTimePlans">
                                <div class="price_box" :id="`price_${pindex}`" @click="changePlan(pindex, plan)">
                                    <p class="font-400 mb-0 ">${{plan.price}}
                                        <span class="small-font float-right" v-if="parseFloat(plan.bonus) > 0">+ ${{parseInt(plan.bonus)}} Bonus</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="notice_div">
                        <div class="icon_div">
                            <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M11.7179 0.0536961C12.2121 -0.0425712 12.7227 -0.00167333 13.2097 0.115043C13.961 0.323622 14.6295 0.825722 15.0243 1.50022C15.7369 2.83412 16.4387 4.174 17.1538 5.50664C17.2979 5.74731 17.3898 6.01503 17.5427 6.25035C17.7283 6.57187 17.8846 6.90912 18.0693 7.23096C18.1939 7.47351 18.2917 7.72991 18.4468 7.95579C18.7803 8.5592 19.0927 9.17392 19.4215 9.77952C19.6338 10.2134 19.8808 10.6289 20.0963 11.0612C20.3203 11.4579 20.5185 11.8688 20.7425 12.2658C21.0561 12.8903 21.4041 13.4971 21.7202 14.1207C22.3413 15.2737 22.9478 16.4349 23.5644 17.5904C23.7997 18.0195 24.0146 18.4596 24.2556 18.8859C24.5412 19.3927 24.7111 19.9769 24.6668 20.5621C24.6067 21.4603 24.1077 22.3226 23.3502 22.8115C23.0309 23.0418 22.6555 23.178 22.2768 23.273C22.1078 23.3142 21.9304 23.3089 21.7646 23.3633H2.88425C2.70367 23.301 2.50799 23.3136 2.32615 23.2557C1.77277 23.1242 1.25714 22.8382 0.854768 22.4362C0.495496 22.0715 0.223682 21.6163 0.095955 21.1196C-0.0528503 20.5618 -0.0283116 19.9577 0.167684 19.4147C0.260805 19.1477 0.408037 18.9051 0.537967 18.6553C2.64767 14.6741 4.76398 10.6956 6.87399 6.71439C6.93597 6.609 7.00329 6.50612 7.05646 6.39538C7.2836 5.90712 7.5617 5.44529 7.80206 4.96396C8.37431 3.89023 8.94405 2.81525 9.51379 1.74026C9.66228 1.44328 9.84695 1.16108 10.086 0.929225C10.5177 0.472742 11.1044 0.174817 11.7179 0.0536961ZM11.962 1.83747C11.711 1.90668 11.4741 2.04511 11.3095 2.2496C11.2262 2.3509 11.1642 2.46699 11.1047 2.58339C9.68619 5.24395 8.2793 7.91081 6.86141 10.5714C6.67202 10.9555 6.45086 11.3226 6.26241 11.7074C5.60647 12.9296 4.965 14.1597 4.30969 15.3822C3.51156 16.8917 2.70618 18.3976 1.9093 19.9077C1.68437 20.3277 1.80737 20.8827 2.16161 21.1919C2.40826 21.4364 2.76344 21.5477 3.10541 21.5496C9.26085 21.5499 15.4163 21.5493 21.5721 21.5499C21.8451 21.5386 22.1261 21.4763 22.3529 21.3168C22.6423 21.1312 22.8349 20.8097 22.8745 20.4699C22.8984 20.2535 22.8295 20.0399 22.7273 19.852C21.6299 17.7741 20.5238 15.7 19.424 13.623C19.2909 13.3672 19.1456 13.118 19.0216 12.8576C18.8835 12.6241 18.7674 12.3791 18.6375 12.1412C18.2518 11.417 17.868 10.6912 17.4807 9.96766C17.3347 9.67162 17.163 9.38911 17.0314 9.08615C16.7496 8.61645 16.5127 8.12127 16.2494 7.64088C16.1024 7.39046 15.9942 7.11959 15.8523 6.86665C15.757 6.72036 15.6708 6.56873 15.5944 6.41174C15.4688 6.15251 15.3197 5.90555 15.1929 5.64695C14.6204 4.58235 14.0626 3.5102 13.4887 2.44654C13.3846 2.24331 13.211 2.0838 13.0181 1.96646C12.7026 1.78022 12.3128 1.75977 11.962 1.83747Z" fill="#FF5858"/>
                                <path d="M12.1173 6.33238C12.4756 6.29148 12.8525 6.35252 13.1608 6.54631C13.4783 6.73255 13.7164 7.04841 13.8017 7.40737C13.8508 7.5955 13.8322 7.79055 13.8206 7.98182C13.7378 8.87749 13.679 9.77567 13.5931 10.671C13.4553 12.3274 13.3257 13.985 13.1816 15.6407C13.1549 15.7707 13.1926 15.9352 13.0781 16.0302C12.8475 16.2306 12.5231 16.2699 12.229 16.2558C12.0015 16.2297 11.7486 16.1932 11.5838 16.0183C11.5139 15.9544 11.5051 15.8553 11.496 15.7672C11.2736 13.1082 11.0593 10.4483 10.8331 7.7896C10.8215 7.48602 10.903 7.17456 11.0895 6.93138C11.3321 6.60388 11.7112 6.37831 12.1173 6.33238Z" fill="#FF5858"/>
                                <path d="M12.1168 17.253C12.4151 17.208 12.7297 17.259 12.9902 17.4141C13.3051 17.5944 13.5303 17.9175 13.598 18.2733C13.6791 18.6089 13.5857 18.9679 13.4023 19.2542C13.1997 19.5486 12.8731 19.7664 12.5139 19.8044C12.2848 19.845 12.0527 19.7887 11.8346 19.7217C11.509 19.5814 11.2363 19.3083 11.1221 18.9695C10.9783 18.5932 11.0359 18.1565 11.2511 17.8196C11.4508 17.527 11.7654 17.3115 12.1168 17.253Z" fill="#FF5858"/>
                            </svg>
                        </div>
                        <p class="display-3 font-600 mb-2 text-white">Attention Title</p>
                        <p class="mb-0 text-white">The credits you are about to add will be used towards sending ($) pending messages. Do you wish to manage your pending messages before adding funds?</p>
                    </div>
                    <div class="btn_div text-right py-3 border-top">
                        <button class="back-btn float-left" @click="closeModal('backcharge')">
                            <svg width="32" height="16" viewBox="0 0 32 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9.58718 0.611497C9.37221 0.231824 8.94046 -0.0188691 8.50266 0.00111366C8.18596 0.000508122 7.88561 0.151893 7.66278 0.371098C5.55247 2.47959 3.42703 4.57354 1.32157 6.68627C1.15928 6.85521 1.06967 7.07563 0.996395 7.29423V7.72416C1.07088 7.94276 1.15868 8.16439 1.32218 8.33333C3.42703 10.4467 5.55308 12.5394 7.66278 14.6485C7.88561 14.8677 8.18596 15.0179 8.50266 15.0173C8.97135 15.0403 9.43095 14.7508 9.62836 14.3288C9.8409 13.8861 9.75612 13.3151 9.40552 12.9663C8.56866 12.1282 7.72696 11.2944 6.88829 10.4588C6.31666 9.87685 5.71476 9.3246 5.16069 8.72633C13.7048 8.71179 22.249 8.72754 30.7932 8.71906C31.3751 8.73359 31.8698 8.27459 32 7.72477V7.29483C31.8698 6.745 31.3757 6.28479 30.7932 6.30054C22.249 6.29267 13.7048 6.3078 5.16069 6.29267C5.39382 6.01957 5.66571 5.78401 5.91337 5.52484C6.99305 4.46454 8.0594 3.39092 9.13424 2.32578C9.25534 2.20467 9.3819 2.08841 9.48969 1.95519C9.79125 1.58278 9.82516 1.02387 9.58718 0.611497Z" fill="black"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn_gray" @click="closeModal('onetime')">Cancel</button>
                        <button class="btn_all ml-2" @click="createPlan()">Enable with Shopify</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script>

var addOneTimeFundModel = "";
export default {
    name: "OneTimePayment",
    props: ["ShowOnetimeFundModel"],
    data(){
      return {
          oneTimePlans:[],
          selectedPlan: [],
          isLoading: false,
      }
    },
    methods:{
        closeModal(type){
            this.$emit('update', type);
        },
        changePlan(index, plan){
            let els = document.getElementsByClassName('price_box');
            for(var i=0; i<els.length; i++){
                els[i].classList.remove('active_li');
                els[i].classList.remove('active_li');
            }
            let el = document.getElementById('price_' + index);
            el.classList.add('active_li');

            this.selectedPlan = plan;
        },
        async createPlan(){
            let url = 'add-fund/onetime';
            let base = this;
            base.isLoading = true;
            await axios.post(url, {data: base.selectedPlan})
                .then(res => {
                    let data = res.data.data;
                    window.top.location.href = data;
                })
                .catch(err => {
                    console.log(err);
                })
                .finally(res => {
                    base.isLoading = false;
                });
        },
        async getData(url = 'get-onetime-funds'){
            let base = this;
            base.isLoading = false;
            await axios.get(url)
                .then(res => {
                    let data = res.data.data;
                    base.oneTimePlans = data.oneTimeFunds;
                })
                .catch(err => {
                    console.log(err);
                })
                .finally(res => {
                    base.isLoading = false;
                });
        },

    },
    watch: {
        ShowOnetimeFundModel(newVal, oldVal) {
            if (newVal === true) {
                $(addOneTimeFundModel).slideDown();
                this.getData();
            } else {
                $(addOneTimeFundModel).slideUp();
            }
        },
    },
    mounted() {
        addOneTimeFundModel = document.getElementById("AddFunds2");
    },
}
</script>

<style scoped>

.price_btn .active_li {
    background-color: #5590F5 !important;
    color: #fff;
}
.price_btn .active_li span{
    color: #fff;
}
.price_btn span {
    color: #707070;
}
</style>
